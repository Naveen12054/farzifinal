{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Booking Form HTML Template</title>

    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">

    <!-- Bootstrap -->
    <link type="text/css" rel="stylesheet" href="{% static 'css/bootstrapins.min.css' %}" />

    <!-- Custom stlylesheet -->
    <link type="text/css" rel="stylesheet" href="{% static 'css/styleins.css' %}" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>
    <!-- This templates was made by Colorlib (https://colorlib.com) -->
<!-- Appointment Start -->
<div class="container-fluid ">
    <div class="dcontainer">
        <div class="row gx-5">
            <div class="col-lg-6 mx-auto" >
            {% if leave_dates %}
            <div class="mx-auto ccontainer ">
                
                <h2 class="leave-dates-heading text-center">{{ therapist.name }} is on leave on the following dates:</h2>
                <ul class="leave-dates-list">
                    {% for leave_date in leave_dates %}
                        <li class="btn btn-warning round">{{ leave_date }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
            <div class="col-lg-12 mx-auto ccontainer">
                
                <div class="a">
                    {% if  user.is_authenticated %}
            
                    <nav class="navbar navbar-expand-lg navbar-light bg-light">
                        
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                          <span class="navbar-toggler-icon"></span>
                        </button>
                      
                        <div class="collapse navbar-collapse d-flex text-align-center justify-content-center" id="navbarSupportedContent">
                            <div class="col-lg-1 mx-auto container">
                                <a href="{% url 'index' %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                                    </svg>
                                </a>
                                Farzi
                            </div>
                            <div class="col-lg-1 mx-auto container">
                
            </div>
                            <div class="col-lg-8 mx-auto container">
                          
                          <b> 
                             <ul class="navbar-nav mr-auto  " style="justify-content: center;">
                            <li class="nav-item active">
                              <a class="nav-link" href="{% url 'index' %}">Home</a>           
                            </li>
                            <li class="nav-item active">
                                <a class="nav-link" href="{% url 'seminar2' %}">Upload</a>           
                              </li>
                            <li class="nav-item active">
                                <a class="nav-link" href="{% url 'list' %}">All Products</a>           
                              </li>
                            {% for product2 in products1 %}
                            {% if forloop.counter <= 6 %}
            
                            <li class="nav-item active">
            
                          <a class=" nav-link " href="/list/sub/{{product2}}" style="text-decoration: none;">
                            {{ product2.name }}
                          </a>
            
                        </li>
                      {% endif%}
            
                      {%endfor%}
                      <li class="nav-item active">
                        <a class="nav-link" href="{% url 'rentuser' %}">Rent</a>           
                      </li>
                      <li class="nav-item active">
                        <a class="nav-link" href="{% url 'services' %}">Services</a>           
                      </li>
                          </ul></b>
                        </div>
                          <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <span class="navbar-text">
                                    Welcome, {{ user.username }}
                                </span>
                            </li>
                        </ul>
                        </div>
                      </nav>
                      {% endif%}
              
              </div>



            </div>
        </div>
        <div class="row gx-5">
            <div class="col-lg-2">
               
            </div>
            <div class="col-lg-8 text-center">
                <div class="bg-light rounded p-5">
                    <h1 class="mb-4 text-center">Book An Appointment</h1>
                    
                    <form method="post" id="appointmentForm">
                        {% if error1 %}
                            <span style="color: red">{{ error1 }}</span><br />
                        {% endif %}
                        <div class="row  ">
                            {% csrf_token %}
                            <div class="col-lg-8">
                                    <div class="mb-3" style="display: flex;">
                                    <div class="big" >
                                    <label for="{{ appointment_form.date.id_for_label }}">Date:</label>
                                        </div>
                                    <div class="desc" style="margin-left: 200px;width: 300px;">
                                        {{ appointment_form.date }}
                                        </div>
                                </div>
                                <br>
                    
                                <div class="mb-3" style="display: flex;">
                                    <div class="big">
                                        <label for="{{ appointment_form.time_slot.id_for_label }}">Time Slot:</label>

                                    </div>
                                    <div class="desc" style="margin-left: 170px;width:full">
                                        {{ appointment_form.time_slot }}

                                        </div>
                                </div>
                    
                                <div class="mb-3"style="display: flex;">
                                    <div class="big">
                                    <label for="{{ appointment_form.mobile.id_for_label }}">Contact Number:</label>
                                </div>
                                <div class="desc" style="margin-left: 120px;width: 300px;">
                                    {{ appointment_form.mobile }}
                                </div>
                            </div>

                            <div class="mb-3"style="display: flex;">
                                <div class="big">
                                    <label for="{{ appointment_form.location.id_for_label }}">Location from Google Map:</label>
                                </div>
                                <div class="desc" style="margin-left: 50px;width: 300px;">
                                    {{ appointment_form.location }}
                                </div>
                            </div>
                            <div class="mb-3"style="display: flex;">
                                <div class="big">
                                    <label for="{{ appointment_form.order_id.id_for_label }}">Landmark near the location</label>
                                </div>
                                <div class="desc" style="margin-left: 50px;width: 300px;">
                                    {{ appointment_form.order_id }}
                                </div>
                            </div>
                            <div class="mb-3"style="display: flex;">
                                <div class="big">
                                    <label for="{{ appointment_form.desc.id_for_label }}">Description Label</label>
                                </div>
                                <div class="desc" style="margin-left: 115px;width: 300px;">                      
                                     {{ appointment_form.desc }}

                                </div>
                            </div>
                               
                            <div class="col-12">
                                {% if error %}
                                    <p class="text-danger">{{ error }}</p>
                                {% endif %}
                                <button class="btn btn-success w-100 py-3" type="submit">
                                    Make An Appointment
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
                </div>
            </div>
            <div class="col-lg-2">
               
            </div>  
            <div class="col-lg-3 mb-5 mb-lg-0">
                <ul>
                    {% for appointment in appointments|dictsort:"date" %}
                     <li>
                        {{ appointment.date }} at {{ appointment.get_time_slot_display }} - {{ appointment.client.name }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- Appointment End -->
<style>
    /* myapp/static/myapp/styles.css */

.custom-input {
    /* Your custom styles for input fields */
    border: 1px solid #ccc;
    padding: 5px;
    /* Add more styles as needed */
}

.custom-textarea {
    /* Your custom styles for textarea */
    border: 1px solid #ccc;
    padding: 5px;
    /* Add more styles as needed */
}

</style>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const appointmentForm = document.getElementById("appointmentForm");
        const dateInput = document.getElementById("date");

        appointmentForm.addEventListener("submit", function (event) {
            const selectedDate = new Date(dateInput.value);
            const today = new Date();
            const maxDate = new Date();
            maxDate.setMonth(today.getMonth() + 3); // Allow up to 3 months in the future

            if (selectedDate < today || selectedDate > maxDate) {
                event.preventDefault(); // Prevent form submission
                alert("Please select a date within the next 3 months.");
            }
        });
    });
</script>

<!-- Include jQuery library -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        function updateAvailableSlots() {
            var selectedDate = $("#date").val();
            var datePattern = /^\d{4}-\d{2}-\d{2}$/;
    
            if (!datePattern.test(selectedDate)) {
                // Invalid date format, show an error message
                $("#available-slots-description").text("Invalid date format. Please select a valid date.");
                return;
            }
    
            var leaveDates = {{ leave_dates | safe }};
    
            if (leaveDates.includes(selectedDate)) {
                // Therapist is on leave, show a message
                $("#available-slots").empty();
                $("#available-slots-description").text("Therapist is on leave on this date.");
                $("#navslot").text("");
                return;
            }
    
            $.ajax({
                type: "GET",
                url: "{% url 'get-available-time-slots' %}",
                data: { date: selectedDate },
                dataType: "json",
                success: function (data) {
                    var availableSlots = data.available_time_slots;
                    var slotsList = $("#available-slots");
                    var description = $("#available-slots-description");
                    var navslot = $("#navslot");
    
                    slotsList.empty();
    
                    if (availableSlots.length > 0) {
                        description.text("Available slots for the selected date:");
                        $.each(availableSlots, function (index, slot) {
                            var slotButton = $("<button></button>")
                                .addClass("slot-button available")
                                .text(slot)
                                .css("margin-right", "10px");
                            slotsList.append(slotButton);
                        });
                        navslot.text("Select your desired time from the dropdown in the appointment form.");
                    } else {
                        description.text("No available slots for the selected date.");
                        slotsList.append("<p>No available slots</p>");
                        navslot.text("");
                    }
                },
                error: function (xhr, status, error) {
                    // Handle errors more gracefully
                    console.error("Error fetching available time slots:", xhr.responseText);
                    $("#available-slots-description").text("Error fetching available time slots. Please try again.");
                },
            });
        }
    
        $("#date").on("change", function () {
            updateAvailableSlots();
        });
    
        updateAvailableSlots();
    });
    
</script>
</body>

</html>
